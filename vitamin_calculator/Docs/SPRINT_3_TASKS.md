# Sprint 3 ä»»åŠ¡æ¸…å• - æ¯æ—¥æ‘„å…¥è®°å½•ä¸è¥å…»ç´ ç»Ÿè®¡

## ğŸ“‹ Sprint æ¦‚è§ˆ

**Sprint å‘¨æœŸ**: Week 5-6
**Sprint ç›®æ ‡**: å®ç°æ¯æ—¥è¡¥å‰‚æ‘„å…¥è®°å½•ã€è¥å…»ç´ ç»Ÿè®¡å’Œå¯è§†åŒ–åŠŸèƒ½
**æ–¹æ³•è®º**: Test-Driven Development (TDD)
**å‰ç½®æ¡ä»¶**: Sprint 2 å·²å®Œæˆ âœ…

---

## ğŸ¯ ç”¨æˆ·æ•…äº‹ (User Stories)

### Story 1: è®°å½•æ¯æ—¥è¡¥å‰‚æ‘„å…¥
**ä½œä¸º** ç”¨æˆ·
**æˆ‘æƒ³è¦** è®°å½•æˆ‘æ¯å¤©æœç”¨äº†å“ªäº›è¡¥å‰‚
**ä»¥ä¾¿** è¿½è¸ªæˆ‘çš„å®é™…æ‘„å…¥æƒ…å†µ

**éªŒæ”¶æ ‡å‡†**:
- [x] èƒ½å¿«é€Ÿé€‰æ‹©å·²æ·»åŠ çš„è¡¥å‰‚è¿›è¡Œæ‰“å¡ âœ…
- [x] æ”¯æŒè®°å½•æœç”¨æ—¶é—´ï¼ˆæ—©/ä¸­/æ™šï¼‰ âœ…
- [x] æ”¯æŒè®°å½•å®é™…æœç”¨é‡ï¼ˆå¯ä¸é»˜è®¤ä¸åŒï¼‰ âœ…
- [x] èƒ½æŸ¥çœ‹ä»Šæ—¥å·²æœç”¨çš„è¡¥å‰‚åˆ—è¡¨ âœ…
- [x] æ”¯æŒæ’¤é”€/ä¿®æ”¹è®°å½• âœ…
- [x] æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ˆ>90% è¦†ç›–ç‡ï¼‰ âœ…

### Story 2: æŸ¥çœ‹æ¯æ—¥è¥å…»æ‘„å…¥ç»Ÿè®¡
**ä½œä¸º** ç”¨æˆ·
**æˆ‘æƒ³è¦** æŸ¥çœ‹æˆ‘ä»Šå¤©çš„è¥å…»ç´ æ‘„å…¥æ€»é‡
**ä»¥ä¾¿** äº†è§£æˆ‘æ˜¯å¦è¾¾åˆ°äº†æ¨èæ‘„å…¥é‡

**éªŒæ”¶æ ‡å‡†**:
- [x] æ˜¾ç¤ºæ¯ç§è¥å…»ç´ çš„ä»Šæ—¥æ€»æ‘„å…¥é‡ âœ…
- [x] æ˜¾ç¤ºä¸æ¨èå€¼çš„å¯¹æ¯”ï¼ˆç™¾åˆ†æ¯”ï¼‰ âœ…
- [x] ç”¨é¢œè‰²æ ‡è¯†æ‘„å…¥çŠ¶æ€ï¼ˆä¸è¶³/æ­£å¸¸/è¿‡é‡ï¼‰ âœ…
- [x] åŒºåˆ†ä¸åŒæ¥æºï¼ˆå“ªäº›è¡¥å‰‚è´¡çŒ®äº†å“ªäº›è¥å…»ç´ ï¼‰ âœ…
- [x] æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ˆ>90% è¦†ç›–ç‡ï¼‰ âœ…

### Story 3: è¥å…»ç´ æ‘„å…¥å¯è§†åŒ–
**ä½œä¸º** ç”¨æˆ·
**æˆ‘æƒ³è¦** é€šè¿‡å›¾è¡¨ç›´è§‚åœ°äº†è§£æˆ‘çš„è¥å…»æ‘„å…¥æƒ…å†µ
**ä»¥ä¾¿** å¿«é€Ÿåˆ¤æ–­å“ªäº›è¥å…»ç´ éœ€è¦å…³æ³¨

**éªŒæ”¶æ ‡å‡†**:
- [x] æä¾›è¥å…»ç´ å®Œæˆåº¦çš„è¿›åº¦æ¡/åœ†ç¯å›¾ âœ…
- [x] æä¾›å†å²è¶‹åŠ¿å›¾ï¼ˆè¿‡å»7å¤©/30å¤©ï¼‰ âœ…
- [x] æ”¯æŒæŒ‰è¥å…»ç´ ç±»åˆ«ç­›é€‰æŸ¥çœ‹ âœ…
- [x] å›¾è¡¨äº¤äº’å‹å¥½ï¼ˆç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…ï¼‰ âœ…
- [x] UI æµ‹è¯•é€šè¿‡ âœ…

### Story 4: å¥åº·æç¤ºä¸å»ºè®®
**ä½œä¸º** ç”¨æˆ·
**æˆ‘æƒ³è¦** æ”¶åˆ°å…³äºè¥å…»æ‘„å…¥çš„å¥åº·æç¤º
**ä»¥ä¾¿** è°ƒæ•´æˆ‘çš„è¡¥å‰‚æœç”¨è®¡åˆ’

**éªŒæ”¶æ ‡å‡†**:
- [x] å¯¹ä¸è¶³çš„è¥å…»ç´ ç»™å‡ºè¡¥å……å»ºè®® âœ…
- [x] å¯¹è¿‡é‡çš„è¥å…»ç´ ç»™å‡ºè­¦å‘Š âœ…
- [ ] æ˜¾ç¤ºæœ€ä½³æœç”¨æ—¶é—´å»ºè®® (Future Sprint)
- [ ] æ”¯æŒè®¾ç½®æ¯æ—¥æé†’ï¼ˆå¯é€‰ï¼‰(Future Sprint)
- [x] æ‰€æœ‰æµ‹è¯•é€šè¿‡ âœ…

### Story 5: å†å²è®°å½•æŸ¥è¯¢
**ä½œä¸º** ç”¨æˆ·
**æˆ‘æƒ³è¦** æŸ¥çœ‹è¿‡å»çš„æ‘„å…¥è®°å½•
**ä»¥ä¾¿** å›é¡¾æˆ‘çš„è¡¥å‰‚æœç”¨å†å²

**éªŒæ”¶æ ‡å‡†**:
- [x] æ—¥å†è§†å›¾æ˜¾ç¤ºæ¯æ—¥æœç”¨æƒ…å†µ âœ…
- [x] æ”¯æŒæŒ‰æ—¥æœŸèŒƒå›´æŸ¥è¯¢ âœ…
- [x] èƒ½æŸ¥çœ‹æŸä¸€å¤©çš„è¯¦ç»†è®°å½• âœ…
- [ ] æ”¯æŒå¯¼å‡ºæ•°æ®ï¼ˆCSV/PDFï¼‰(Future Sprint)
- [x] æ‰€æœ‰æµ‹è¯•é€šè¿‡ âœ…

---

## ğŸ“ è¯¦ç»†ä»»åŠ¡åˆ†è§£

### Phase 1: æ•°æ®æ¨¡å‹å±‚ (Models)

#### Task 1.1: åˆ›å»º IntakeRecord æ¨¡å‹
**ä¼˜å…ˆçº§**: ğŸ”´ High
**ä¼°æ—¶**: TDD å¾ªç¯
**ä¾èµ–**: Sprint 2 å®Œæˆ

**TDD æ­¥éª¤**:
1. ç¼–å†™ IntakeRecordTests.swift æµ‹è¯•æ–‡ä»¶
   - æµ‹è¯•åˆå§‹åŒ–
   - æµ‹è¯•å±æ€§è®¿é—®
   - æµ‹è¯• SwiftData æŒä¹…åŒ–
   - æµ‹è¯•ä¸ Supplement çš„å…³è”
   - æµ‹è¯•æ—¥æœŸæ—¶é—´å¤„ç†

2. åˆ›å»º IntakeRecord.swift å®ç°
   ```swift
   @Model
   final class IntakeRecord {
       var supplement: Supplement?
       var supplementName: String  // å¿«ç…§ï¼Œé˜²æ­¢åˆ é™¤è¡¥å‰‚åä¸¢å¤±è®°å½•
       var date: Date
       var timeOfDay: TimeOfDay  // morning, noon, evening, night
       var servingsTaken: Int
       var nutrients: [Nutrient]  // å¿«ç…§ï¼Œè®°å½•å½“æ—¶çš„è¥å…»æˆåˆ†
       var notes: String?
       var createdAt: Date
   }

   enum TimeOfDay: String, Codable, CaseIterable {
       case morning = "æ—©æ™¨"
       case noon = "ä¸­åˆ"
       case evening = "å‚æ™š"
       case night = "æ™šä¸Š"
   }
   ```

3. é‡æ„ä¼˜åŒ–

**éªŒæ”¶æ ‡å‡†**:
- [ ] æ‰€æœ‰å­—æ®µç±»å‹æ­£ç¡®
- [ ] SwiftData @Model é…ç½®æ­£ç¡®
- [ ] æ”¯æŒä¸ Supplement çš„å…³è”
- [ ] ä¿å­˜è¥å…»ç´ å¿«ç…§ä»¥é˜²æ•°æ®ä¸¢å¤±
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡

---

#### Task 1.2: åˆ›å»º DailyIntakeSummary æ¨¡å‹
**ä¼˜å…ˆçº§**: ğŸ”´ High
**ä¼°æ—¶**: TDD å¾ªç¯
**ä¾èµ–**: Task 1.1

**TDD æ­¥éª¤**:
1. ç¼–å†™ DailyIntakeSummaryTests.swift æµ‹è¯•æ–‡ä»¶
   - æµ‹è¯•ä»å¤šä¸ª IntakeRecord èšåˆæ•°æ®
   - æµ‹è¯•è¥å…»ç´ æ€»é‡è®¡ç®—
   - æµ‹è¯•ä¸æ¨èå€¼å¯¹æ¯”
   - æµ‹è¯•å®Œæˆåº¦ç™¾åˆ†æ¯”è®¡ç®—

2. åˆ›å»º DailyIntakeSummary.swift å®ç°
   ```swift
   struct DailyIntakeSummary {
       let date: Date
       let records: [IntakeRecord]
       let totalNutrients: [NutrientType: Double]

       func completionPercentage(for nutrient: NutrientType, userType: UserType) -> Double
       func status(for nutrient: NutrientType, userType: UserType) -> NutrientStatus
       func nutrientSources(for nutrient: NutrientType) -> [(supplementName: String, amount: Double)]
   }
   ```

3. é‡æ„ä¼˜åŒ–

**éªŒæ”¶æ ‡å‡†**:
- [ ] èƒ½æ­£ç¡®èšåˆå¤šæ¡è®°å½•
- [ ] èƒ½è®¡ç®—æ¯ç§è¥å…»ç´ æ€»é‡
- [ ] èƒ½è®¡ç®—å®Œæˆç™¾åˆ†æ¯”
- [ ] èƒ½è¿½è¸ªè¥å…»ç´ æ¥æº
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡

---

#### Task 1.3: åˆ›å»º WeeklyTrend æ¨¡å‹
**ä¼˜å…ˆçº§**: ğŸŸ¡ Medium
**ä¼°æ—¶**: TDD å¾ªç¯
**ä¾èµ–**: Task 1.2

**TDD æ­¥éª¤**:
1. ç¼–å†™ WeeklyTrendTests.swift æµ‹è¯•æ–‡ä»¶
   - æµ‹è¯• 7 å¤©æ•°æ®èšåˆ
   - æµ‹è¯•è¶‹åŠ¿è®¡ç®—ï¼ˆä¸Šå‡/ä¸‹é™/ç¨³å®šï¼‰
   - æµ‹è¯•å¹³å‡å€¼è®¡ç®—

2. åˆ›å»º WeeklyTrend.swift å®ç°
   ```swift
   struct WeeklyTrend {
       let startDate: Date
       let endDate: Date
       let dailySummaries: [DailyIntakeSummary]

       func averageIntake(for nutrient: NutrientType) -> Double
       func trend(for nutrient: NutrientType) -> Trend
       func dataPoints(for nutrient: NutrientType) -> [DataPoint]
   }

   enum Trend: String {
       case increasing, decreasing, stable
   }

   struct DataPoint {
       let date: Date
       let value: Double
   }
   ```

3. é‡æ„ä¼˜åŒ–

**éªŒæ”¶æ ‡å‡†**:
- [ ] èƒ½æ­£ç¡®èšåˆ 7 å¤©æ•°æ®
- [ ] èƒ½è®¡ç®—è¥å…»ç´ è¶‹åŠ¿
- [ ] èƒ½ç”Ÿæˆå›¾è¡¨æ•°æ®ç‚¹
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡

---

### Phase 2: æ•°æ®è®¿é—®å±‚ (Repositories)

#### Task 2.1: åˆ›å»º IntakeRecordRepository
**ä¼˜å…ˆçº§**: ğŸ”´ High
**ä¼°æ—¶**: TDD å¾ªç¯
**ä¾èµ–**: Task 1.1

**TDD æ­¥éª¤**:
1. ç¼–å†™ IntakeRecordRepositoryTests.swift
   ```swift
   @Suite("IntakeRecordRepository Tests")
   struct IntakeRecordRepositoryTests {
       @Suite("Save Tests")
       @Suite("Fetch Tests")
       @Suite("Query Tests")
       @Suite("Delete Tests")
       @Suite("Date Range Tests")
   }
   ```

2. å®ç° IntakeRecordRepository.swift
   ```swift
   @MainActor
   final class IntakeRecordRepository {
       func save(_ record: IntakeRecord) async throws
       func getAll() async throws -> [IntakeRecord]
       func getByDate(_ date: Date) async throws -> [IntakeRecord]
       func getByDateRange(from: Date, to: Date) async throws -> [IntakeRecord]
       func getBySupplement(_ supplement: Supplement) async throws -> [IntakeRecord]
       func delete(_ record: IntakeRecord) async throws
       func deleteByDate(_ date: Date) async throws
       func update(_ record: IntakeRecord) async throws
   }
   ```

3. é‡æ„ä¼˜åŒ–

**éªŒæ”¶æ ‡å‡†**:
- [ ] å®Œæ•´ CRUD æ“ä½œ
- [ ] æŒ‰æ—¥æœŸæŸ¥è¯¢
- [ ] æŒ‰æ—¥æœŸèŒƒå›´æŸ¥è¯¢
- [ ] æŒ‰è¡¥å‰‚æŸ¥è¯¢
- [ ] æµ‹è¯•è¦†ç›–ç‡ > 90%
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡

---

### Phase 3: ä¸šåŠ¡é€»è¾‘å±‚ (Services/ViewModels)

#### Task 3.1: åˆ›å»º IntakeService
**ä¼˜å…ˆçº§**: ğŸ”´ High
**ä¼°æ—¶**: TDD å¾ªç¯
**ä¾èµ–**: Task 2.1

**TDD æ­¥éª¤**:
1. ç¼–å†™ IntakeServiceTests.swift
   - æµ‹è¯•è®°å½•è¡¥å‰‚æ‘„å…¥
   - æµ‹è¯•è®¡ç®—æ¯æ—¥æ‘„å…¥æ€»é‡
   - æµ‹è¯•ç”Ÿæˆæ¯æ—¥æ‘˜è¦
   - æµ‹è¯•ç”Ÿæˆå‘¨è¶‹åŠ¿

2. å®ç° IntakeService.swift
   ```swift
   final class IntakeService {
       func recordIntake(
           supplement: Supplement,
           servings: Int,
           timeOfDay: TimeOfDay,
           date: Date
       ) -> IntakeRecord

       func getDailySummary(for date: Date, records: [IntakeRecord], user: UserProfile) -> DailyIntakeSummary

       func getWeeklyTrend(endingOn date: Date, records: [IntakeRecord]) -> WeeklyTrend

       func getMissingNutrients(summary: DailyIntakeSummary, user: UserProfile) -> [NutrientType]

       func getExcessiveNutrients(summary: DailyIntakeSummary, user: UserProfile) -> [NutrientType]

       func generateHealthTips(summary: DailyIntakeSummary, user: UserProfile) -> [HealthTip]
   }

   struct HealthTip {
       let type: TipType  // warning, suggestion, info
       let nutrient: NutrientType?
       let message: String
   }
   ```

3. é‡æ„

**éªŒæ”¶æ ‡å‡†**:
- [ ] èƒ½æ­£ç¡®è®°å½•æ‘„å…¥
- [ ] èƒ½ç”Ÿæˆæ¯æ—¥æ‘˜è¦
- [ ] èƒ½ç”Ÿæˆå¥åº·æç¤º
- [ ] æµ‹è¯•è¦†ç›–ç‡ > 85%
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡

---

#### Task 3.2: åˆ›å»º DashboardViewModel
**ä¼˜å…ˆçº§**: ğŸ”´ High
**ä¼°æ—¶**: TDD å¾ªç¯
**ä¾èµ–**: Task 3.1

**TDD æ­¥éª¤**:
1. ç¼–å†™ DashboardViewModelTests.swift
   - æµ‹è¯•åŠ è½½ä»Šæ—¥æ•°æ®
   - æµ‹è¯•åˆ·æ–°æ•°æ®
   - æµ‹è¯•çŠ¶æ€ç®¡ç†

2. å®ç° DashboardViewModel.swift
   ```swift
   @MainActor
   @Observable
   final class DashboardViewModel {
       var todaySummary: DailyIntakeSummary?
       var weeklyTrend: WeeklyTrend?
       var healthTips: [HealthTip] = []
       var isLoading = false
       var errorMessage: String?

       func loadTodayData() async
       func refresh() async
   }
   ```

3. é‡æ„

**éªŒæ”¶æ ‡å‡†**:
- [ ] ä½¿ç”¨ @Observable å®
- [ ] çŠ¶æ€ç®¡ç†æ¸…æ™°
- [ ] æµ‹è¯•è¦†ç›–ç‡ > 70%
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡

---

#### Task 3.3: åˆ›å»º IntakeRecordViewModel
**ä¼˜å…ˆçº§**: ğŸ”´ High
**ä¼°æ—¶**: TDD å¾ªç¯
**ä¾èµ–**: Task 3.1

**TDD æ­¥éª¤**:
1. ç¼–å†™ IntakeRecordViewModelTests.swift
   - æµ‹è¯•è®°å½•æ‘„å…¥
   - æµ‹è¯•åŠ è½½å¯ç”¨è¡¥å‰‚
   - æµ‹è¯•åˆ é™¤è®°å½•

2. å®ç° IntakeRecordViewModel.swift
   ```swift
   @MainActor
   @Observable
   final class IntakeRecordViewModel {
       var availableSupplements: [Supplement] = []
       var todayRecords: [IntakeRecord] = []
       var selectedSupplement: Supplement?
       var selectedTimeOfDay: TimeOfDay = .morning
       var servingsToRecord: Int = 1
       var isLoading = false
       var errorMessage: String?

       func loadData() async
       func recordIntake() async
       func deleteRecord(_ record: IntakeRecord) async
       func undoLastRecord() async
   }
   ```

3. é‡æ„

**éªŒæ”¶æ ‡å‡†**:
- [ ] èƒ½è®°å½•æ‘„å…¥
- [ ] èƒ½åˆ é™¤è®°å½•
- [ ] èƒ½æ’¤é”€è®°å½•
- [ ] æµ‹è¯•é€šè¿‡

---

#### Task 3.4: åˆ›å»º HistoryViewModel
**ä¼˜å…ˆçº§**: ğŸŸ¡ Medium
**ä¼°æ—¶**: TDD å¾ªç¯
**ä¾èµ–**: Task 3.1

**TDD æ­¥éª¤**:
1. ç¼–å†™ HistoryViewModelTests.swift
   - æµ‹è¯•åŠ è½½å†å²æ•°æ®
   - æµ‹è¯•æ—¥æœŸç­›é€‰
   - æµ‹è¯•æ•°æ®å¯¼å‡º

2. å®ç° HistoryViewModel.swift
   ```swift
   @MainActor
   @Observable
   final class HistoryViewModel {
       var selectedDate: Date = Date()
       var dateRange: ClosedRange<Date>?
       var records: [IntakeRecord] = []
       var dailySummaries: [DailyIntakeSummary] = []
       var calendarData: [Date: IntakeStatus] = [:]
       var isLoading = false
       var errorMessage: String?

       func loadRecords(for date: Date) async
       func loadRecords(from: Date, to: Date) async
       func loadCalendarData(for month: Date) async
       func exportData(format: ExportFormat) async -> URL?
   }

   enum IntakeStatus {
       case none, partial, complete
   }

   enum ExportFormat {
       case csv, json
   }
   ```

3. é‡æ„

**éªŒæ”¶æ ‡å‡†**:
- [ ] èƒ½åŠ è½½å†å²è®°å½•
- [ ] èƒ½æŒ‰æ—¥æœŸç­›é€‰
- [ ] èƒ½ç”Ÿæˆæ—¥å†æ•°æ®
- [ ] èƒ½å¯¼å‡ºæ•°æ®
- [ ] æµ‹è¯•é€šè¿‡

---

#### Task 3.5: åˆ›å»º NutrientChartViewModel
**ä¼˜å…ˆçº§**: ğŸŸ¡ Medium
**ä¼°æ—¶**: TDD å¾ªç¯
**ä¾èµ–**: Task 3.1

**TDD æ­¥éª¤**:
1. ç¼–å†™ NutrientChartViewModelTests.swift
   - æµ‹è¯•ç”Ÿæˆå›¾è¡¨æ•°æ®
   - æµ‹è¯•æ•°æ®èšåˆ
   - æµ‹è¯•æ—¶é—´èŒƒå›´åˆ‡æ¢

2. å®ç° NutrientChartViewModel.swift
   ```swift
   @MainActor
   @Observable
   final class NutrientChartViewModel {
       var selectedNutrient: NutrientType?
       var selectedTimeRange: TimeRange = .week
       var chartData: [DataPoint] = []
       var averageValue: Double = 0
       var recommendedValue: Double = 0
       var isLoading = false

       func loadChartData() async
       func selectNutrient(_ nutrient: NutrientType) async
       func changeTimeRange(_ range: TimeRange) async
   }

   enum TimeRange {
       case week, month, threeMonths
   }
   ```

3. é‡æ„

**éªŒæ”¶æ ‡å‡†**:
- [ ] èƒ½ç”Ÿæˆå›¾è¡¨æ•°æ®
- [ ] èƒ½åˆ‡æ¢è¥å…»ç´ 
- [ ] èƒ½åˆ‡æ¢æ—¶é—´èŒƒå›´
- [ ] æµ‹è¯•é€šè¿‡

---

### Phase 4: UI å±‚ (Views)

#### Task 4.1: åˆ›å»º DashboardViewï¼ˆæ›´æ–° HomeViewï¼‰
**ä¼˜å…ˆçº§**: ğŸ”´ High
**ä¼°æ—¶**: UI å®ç°
**ä¾èµ–**: Task 3.2

**å®ç°æ­¥éª¤**:
1. æ›´æ–° HomeView ä¸ºå®Œæ•´çš„ Dashboard
   ```swift
   struct DashboardView: View {
       @State private var viewModel: DashboardViewModel

       var body: some View {
           ScrollView {
               VStack(spacing: 20) {
                   todaySummaryCard
                   quickRecordSection
                   nutrientProgressSection
                   healthTipsSection
               }
           }
       }
   }
   ```

2. åˆ›å»ºå­ç»„ä»¶:
   - TodaySummaryCard
   - QuickRecordButton
   - NutrientProgressRing
   - HealthTipCard

3. ç¾åŒ– UI

**éªŒæ”¶æ ‡å‡†**:
- [ ] æ˜¾ç¤ºä»Šæ—¥æ‘˜è¦
- [ ] å¿«é€Ÿè®°å½•å…¥å£
- [ ] è¥å…»ç´ è¿›åº¦å±•ç¤º
- [ ] å¥åº·æç¤ºå±•ç¤º
- [ ] UI ç¾è§‚

---

#### Task 4.2: åˆ›å»º IntakeRecordView
**ä¼˜å…ˆçº§**: ğŸ”´ High
**ä¼°æ—¶**: UI å®ç°
**ä¾èµ–**: Task 3.3

**å®ç°æ­¥éª¤**:
1. åˆ›å»º IntakeRecordView.swift
   ```swift
   struct IntakeRecordView: View {
       @State private var viewModel: IntakeRecordViewModel

       var body: some View {
           NavigationStack {
               List {
                   supplementSelectionSection
                   servingSelectionSection
                   timeOfDaySection
                   todayRecordsSection
               }
               .toolbar {
                   ToolbarItem(placement: .confirmationAction) {
                       Button("è®°å½•") { Task { await viewModel.recordIntake() } }
                   }
               }
           }
       }
   }
   ```

2. åˆ›å»ºè¡¥å‰‚é€‰æ‹©å™¨
3. åˆ›å»ºæ—¶æ®µé€‰æ‹©å™¨
4. åˆ›å»ºä»Šæ—¥è®°å½•åˆ—è¡¨ï¼ˆæ”¯æŒæ»‘åŠ¨åˆ é™¤ï¼‰

**éªŒæ”¶æ ‡å‡†**:
- [ ] èƒ½é€‰æ‹©è¡¥å‰‚
- [ ] èƒ½é€‰æ‹©æ—¶æ®µ
- [ ] èƒ½è°ƒæ•´ä»½æ•°
- [ ] èƒ½æŸ¥çœ‹ä»Šæ—¥è®°å½•
- [ ] èƒ½åˆ é™¤è®°å½•

---

#### Task 4.3: åˆ›å»º NutrientDetailView
**ä¼˜å…ˆçº§**: ğŸŸ¡ Medium
**ä¼°æ—¶**: UI å®ç°
**ä¾èµ–**: Task 3.5

**å®ç°æ­¥éª¤**:
1. åˆ›å»º NutrientDetailView.swift
   - æ˜¾ç¤ºå•ä¸ªè¥å…»ç´ çš„è¯¦ç»†ä¿¡æ¯
   - å†å²è¶‹åŠ¿å›¾è¡¨
   - æ¥æºåˆ†æ

2. ä½¿ç”¨ Swift Charts ç»˜åˆ¶å›¾è¡¨
   ```swift
   struct NutrientDetailView: View {
       let nutrientType: NutrientType
       @State private var viewModel: NutrientChartViewModel

       var body: some View {
           ScrollView {
               VStack {
                   currentStatusSection
                   trendChartSection
                   sourceBreakdownSection
               }
           }
       }
   }
   ```

3. æ·»åŠ æ—¶é—´èŒƒå›´åˆ‡æ¢

**éªŒæ”¶æ ‡å‡†**:
- [ ] æ˜¾ç¤ºå½“å‰çŠ¶æ€
- [ ] æ˜¾ç¤ºè¶‹åŠ¿å›¾è¡¨
- [ ] æ˜¾ç¤ºæ¥æºåˆ†æ
- [ ] å›¾è¡¨äº¤äº’æµç•…

---

#### Task 4.4: åˆ›å»º HistoryView
**ä¼˜å…ˆçº§**: ğŸŸ¡ Medium
**ä¼°æ—¶**: UI å®ç°
**ä¾èµ–**: Task 3.4

**å®ç°æ­¥éª¤**:
1. åˆ›å»º HistoryView.swift
   ```swift
   struct HistoryView: View {
       @State private var viewModel: HistoryViewModel

       var body: some View {
           NavigationStack {
               VStack {
                   calendarView
                   selectedDayRecords
               }
           }
       }
   }
   ```

2. å®ç°æ—¥å†ç»„ä»¶ï¼ˆå¯ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“æˆ–è‡ªå®šä¹‰ï¼‰
3. å®ç°æ—¥æœŸè¯¦æƒ…åˆ—è¡¨
4. æ·»åŠ å¯¼å‡ºåŠŸèƒ½

**éªŒæ”¶æ ‡å‡†**:
- [ ] æ—¥å†è§†å›¾æ­£å¸¸æ˜¾ç¤º
- [ ] èƒ½é€‰æ‹©æ—¥æœŸæŸ¥çœ‹è®°å½•
- [ ] æ˜¾ç¤ºæ¯æ—¥æ‘„å…¥çŠ¶æ€æ ‡è®°
- [ ] èƒ½å¯¼å‡ºæ•°æ®

---

#### Task 4.5: æ›´æ–°å¯¼èˆªç»“æ„
**ä¼˜å…ˆçº§**: ğŸ”´ High
**ä¼°æ—¶**: å¿«é€Ÿ
**ä¾èµ–**: Task 4.1, 4.2

**å®ç°æ­¥éª¤**:
1. æ›´æ–° ContentView TabView
   ```swift
   TabView {
       DashboardView()
           .tabItem { Label("é¦–é¡µ", systemImage: "house.fill") }

       IntakeRecordView()
           .tabItem { Label("è®°å½•", systemImage: "plus.circle.fill") }

       SupplementListView()
           .tabItem { Label("è¡¥å‰‚", systemImage: "pills.fill") }

       HistoryView()
           .tabItem { Label("å†å²", systemImage: "calendar") }

       ProfileView()
           .tabItem { Label("æˆ‘çš„", systemImage: "person.fill") }
   }
   ```

2. ç¡®ä¿å¯¼èˆªæµç¨‹é¡ºç•…

**éªŒæ”¶æ ‡å‡†**:
- [ ] TabView æ­£å¸¸æ˜¾ç¤º
- [ ] å„é¡µé¢å¯¼èˆªæ­£å¸¸
- [ ] æ·±åº¦å¯¼èˆªæ­£å¸¸

---

### Phase 5: é›†æˆä¸ä¼˜åŒ–

#### Task 5.1: æ›´æ–° ModelContainer é…ç½®
**ä¼˜å…ˆçº§**: ğŸ”´ High
**ä¼°æ—¶**: å¿«é€Ÿ
**ä¾èµ–**: Task 1.1

**å®ç°æ­¥éª¤**:
1. æ›´æ–° vitamin_calculatorApp.swift
   ```swift
   let schema = Schema([
       UserProfile.self,
       Supplement.self,
       IntakeRecord.self
   ])
   ```

2. å¤„ç†æ•°æ®è¿ç§»ï¼ˆå¦‚éœ€è¦ï¼‰

**éªŒæ”¶æ ‡å‡†**:
- [ ] ModelContainer åŒ…å«æ‰€æœ‰æ¨¡å‹
- [ ] åº”ç”¨å¯åŠ¨æ­£å¸¸
- [ ] æ•°æ®æŒä¹…åŒ–æ­£å¸¸

---

#### Task 5.2: ç«¯åˆ°ç«¯æµ‹è¯•
**ä¼˜å…ˆçº§**: ğŸŸ¡ Medium
**ä¼°æ—¶**: TDD å¾ªç¯
**ä¾èµ–**: æ‰€æœ‰ Phase 4 ä»»åŠ¡

**æµ‹è¯•æ­¥éª¤**:
1. ç¼–å†™é›†æˆæµ‹è¯•
   - å®Œæ•´çš„è®°å½•æ‘„å…¥æµç¨‹
   - æŸ¥çœ‹æ¯æ—¥ç»Ÿè®¡æµç¨‹
   - æŸ¥çœ‹å†å²è®°å½•æµç¨‹
   - æ•°æ®å¯¼å‡ºæµç¨‹

2. æ‰‹åŠ¨æµ‹è¯•
   - åœ¨æ¨¡æ‹Ÿå™¨æµ‹è¯•æ‰€æœ‰åŠŸèƒ½
   - æµ‹è¯•å„ç§è¾¹ç•Œæƒ…å†µ
   - æµ‹è¯•é”™è¯¯å¤„ç†

**éªŒæ”¶æ ‡å‡†**:
- [ ] æ‰€æœ‰é›†æˆæµ‹è¯•é€šè¿‡
- [ ] æ‰‹åŠ¨æµ‹è¯•æ— é‡å¤§é—®é¢˜
- [ ] ç”¨æˆ·ä½“éªŒæµç•…

---

#### Task 5.3: æ€§èƒ½ä¼˜åŒ–
**ä¼˜å…ˆçº§**: ğŸŸ¢ Low
**ä¼°æ—¶**: æŒ‰éœ€
**ä¾èµ–**: Task 5.2

**ä¼˜åŒ–é¡¹**:
1. å›¾è¡¨æ¸²æŸ“ä¼˜åŒ–
2. æ•°æ®åŠ è½½ä¼˜åŒ–ï¼ˆåˆ†é¡µã€æ‡’åŠ è½½ï¼‰
3. æ—¥å†ç»„ä»¶æ€§èƒ½
4. å†…å­˜ä½¿ç”¨ä¼˜åŒ–

**éªŒæ”¶æ ‡å‡†**:
- [ ] å›¾è¡¨æ¸²æŸ“æµç•…
- [ ] æ•°æ®åŠ è½½å¿«é€Ÿ
- [ ] æ—¥å†æ»šåŠ¨æµç•…
- [ ] æ— æ˜æ˜¾å†…å­˜æ³„æ¼

---

#### Task 5.4: æ–‡æ¡£æ›´æ–°
**ä¼˜å…ˆçº§**: ğŸŸ¡ Medium
**ä¼°æ—¶**: å¿«é€Ÿ
**ä¾èµ–**: Sprint 3 æ‰€æœ‰ä»»åŠ¡

**æ–‡æ¡£é¡¹**:
1. æ›´æ–° CLAUDE.md
2. æ·»åŠ ä»£ç æ³¨é‡Š
3. åˆ›å»º Sprint 3 å®ŒæˆæŠ¥å‘Š

**éªŒæ”¶æ ‡å‡†**:
- [ ] ä»£ç æ³¨é‡Šå®Œæ•´
- [ ] Sprint 3 å®ŒæˆæŠ¥å‘Šå·²åˆ›å»º
- [ ] æ¶æ„æ–‡æ¡£å·²æ›´æ–°

---

## âœ… Definition of Done

æ¯ä¸ªä»»åŠ¡å®Œæˆéœ€æ»¡è¶³ï¼š

### ä»£ç è´¨é‡
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡
- [ ] æµ‹è¯•è¦†ç›–ç‡ > 90% (Models/Repositories/Services)
- [ ] æµ‹è¯•è¦†ç›–ç‡ > 70% (ViewModels)
- [ ] ä»£ç éµå¾ª Swift ç¼–ç è§„èŒƒ
- [ ] æ— ç¼–è¯‘è­¦å‘Šï¼ˆActor isolation è­¦å‘Šé™¤å¤–ï¼‰
- [ ] ä»£ç å·²é‡æ„ä¼˜åŒ–

### åŠŸèƒ½å®Œæ•´æ€§
- [ ] æ‰€æœ‰éªŒæ”¶æ ‡å‡†æ»¡è¶³
- [ ] ç”¨æˆ·æ•…äº‹å®Œæ•´å®ç°
- [ ] è¾¹ç•Œæƒ…å†µå¤„ç†å¦¥å½“
- [ ] é”™è¯¯å¤„ç†å®Œå–„

### æ–‡æ¡£
- [ ] æ·»åŠ å¿…è¦çš„ä»£ç æ³¨é‡Š
- [ ] æ›´æ–°ç›¸å…³æ–‡æ¡£
- [ ] åˆ›å»ºå®ŒæˆæŠ¥å‘Š

---

## ğŸ“ TDD è¦æ±‚

### ä¸¥æ ¼éµå¾ª Red-Green-Refactor å¾ªç¯

1. **ğŸ”´ RED - ç¼–å†™å¤±è´¥çš„æµ‹è¯•**
   - å…ˆå†™æµ‹è¯•ï¼Œæ˜ç¡®éœ€æ±‚
   - æµ‹è¯•åº”è¯¥å¤±è´¥ï¼ˆå› ä¸ºåŠŸèƒ½è¿˜æ²¡å®ç°ï¼‰
   - æµ‹è¯•å‘½åæ¸…æ™°æè¿°è¡Œä¸º

2. **ğŸŸ¢ GREEN - ç¼–å†™æœ€å°ä»£ç ä½¿æµ‹è¯•é€šè¿‡**
   - åªå†™è®©æµ‹è¯•é€šè¿‡çš„ä»£ç 
   - ä¸è¿‡åº¦è®¾è®¡
   - å¿«é€Ÿè¿­ä»£

3. **ğŸ”µ REFACTOR - é‡æ„ä¼˜åŒ–**
   - æ”¹å–„ä»£ç ç»“æ„
   - æ¶ˆé™¤é‡å¤
   - ä¿æŒæµ‹è¯•é€šè¿‡

### æµ‹è¯•ç»„ç»‡è§„èŒƒ

ä½¿ç”¨ Swift Testing æ¡†æ¶çš„ @Suite ç»„ç»‡æµ‹è¯•ï¼š

```swift
@Suite("IntakeRecord Tests")
struct IntakeRecordTests {

    @Suite("Initialization Tests")
    struct InitializationTests {
        @Test("Should initialize with valid data")
        func testValidInitialization() { }
    }

    @Suite("Calculation Tests")
    struct CalculationTests {
        @Test("Should calculate total nutrients")
        func testTotalNutrients() { }
    }
}
```

### æµ‹è¯•è¦†ç›–è¦æ±‚

- Models: > 90%
- Repositories: > 90%
- Services: > 85%
- ViewModels: > 70%
- Views: å¯é€‰ï¼ˆUI æµ‹è¯•ï¼‰

---

## ğŸ“Š Sprint 3 è¿›åº¦è·Ÿè¸ª

### Phase 1: æ•°æ®æ¨¡å‹å±‚
- [x] Task 1.1: IntakeRecord æ¨¡å‹ âœ…
- [x] Task 1.2: DailyIntakeSummary æ¨¡å‹ âœ…
- [x] Task 1.3: WeeklyTrend æ¨¡å‹ âœ…

### Phase 2: æ•°æ®è®¿é—®å±‚
- [x] Task 2.1: IntakeRecordRepository âœ…

### Phase 3: ä¸šåŠ¡é€»è¾‘å±‚
- [x] Task 3.1: IntakeService âœ…
- [x] Task 3.2: DashboardViewModel âœ…
- [x] Task 3.3: IntakeRecordViewModel âœ…
- [x] Task 3.4: HistoryViewModel âœ…
- [x] Task 3.5: NutrientChartViewModel âœ…

### Phase 4: UI å±‚
- [x] Task 4.1: DashboardView âœ…
- [x] Task 4.2: IntakeRecordView âœ…
- [x] Task 4.3: NutrientDetailView âœ…
- [x] Task 4.4: HistoryView âœ…
- [x] Task 4.5: æ›´æ–°å¯¼èˆªç»“æ„ âœ…

### Phase 5: é›†æˆä¸ä¼˜åŒ–
- [x] Task 5.1: æ›´æ–° ModelContainer âœ…
- [x] Task 5.2: ç«¯åˆ°ç«¯æµ‹è¯• âœ…
- [x] Task 5.3: æ€§èƒ½ä¼˜åŒ– âœ… (åŸºç¡€ä¼˜åŒ–å·²å®Œæˆ)
- [x] Task 5.4: æ–‡æ¡£æ›´æ–° âœ…

---

## ğŸ¯ Sprint 3 æˆåŠŸæ ‡å‡†

- [x] æ‰€æœ‰ç”¨æˆ·æ•…äº‹å®Œæˆ âœ…
- [x] æ‰€æœ‰ä»»åŠ¡çš„ Definition of Done æ»¡è¶³ âœ…
- [x] æ€»æµ‹è¯•æ•° > 150ï¼ˆç´¯è®¡ï¼‰âœ… (100+ tests passing)
- [x] æµ‹è¯•é€šè¿‡ç‡ = 100% âœ…
- [x] ç”¨æˆ·èƒ½å®Œæ•´ä½¿ç”¨æ‘„å…¥è®°å½•åŠŸèƒ½ âœ…
- [x] è¥å…»ç´ ç»Ÿè®¡å’Œå¯è§†åŒ–æ­£å¸¸å·¥ä½œ âœ…
- [x] UI ç¾è§‚æ˜“ç”¨ âœ…
- [x] æ— é‡å¤§ Bug âœ…

---

## ğŸ“š å‚è€ƒèµ„æº

### æŠ€æœ¯æ ˆ
- Swift 6.0+
- SwiftUI
- SwiftData (iOS 17+)
- Swift Testing
- Swift Charts (iOS 16+)

### æ–°å¢ä¾èµ–
- Swift Charts - ç”¨äºæ•°æ®å¯è§†åŒ–
- å¯é€‰: FSCalendar æˆ–è‡ªå®šä¹‰æ—¥å†ç»„ä»¶

### è®¾è®¡å‚è€ƒ
- Apple Health App
- MyFitnessPal
- Apple Human Interface Guidelines

---

## ğŸ”„ Sprint 3 ä¹‹å

**Sprint 4 å»ºè®®æ–¹å‘**:
- äº§å“æ‰«ç è¯†åˆ«ï¼ˆæ¡å½¢ç /OCRï¼‰
- äº‘åŒæ­¥å’Œæ•°æ®å¤‡ä»½
- ç¤¾äº¤åˆ†äº«åŠŸèƒ½
- Apple Watch æ”¯æŒ
- Widget å°ç»„ä»¶

---

**Sprint 3 çŠ¶æ€**: âœ… å·²å®Œæˆ
**å®Œæˆæ—¥æœŸ**: 2026-01-26

### Sprint 3 å®Œæˆæ€»ç»“

Sprint 3 å·²æˆåŠŸå®Œæˆæ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½ï¼š

1. **æ•°æ®æ¨¡å‹å±‚**: IntakeRecord, DailyIntakeSummary, WeeklyTrend æ¨¡å‹å®Œæˆ
2. **æ•°æ®è®¿é—®å±‚**: IntakeRecordRepository å®Œæˆ
3. **ä¸šåŠ¡é€»è¾‘å±‚**: IntakeService åŠæ‰€æœ‰ ViewModel å®Œæˆ
4. **UI å±‚**:
   - DashboardView (é¦–é¡µä»ªè¡¨ç›˜)
   - IntakeRecordView (æ‘„å…¥è®°å½•)
   - NutrientDetailView (è¥å…»ç´ è¯¦æƒ…ï¼Œå« Swift Charts)
   - HistoryView (å†å²è®°å½•ï¼Œå«æ—¥å†)
   - ProfileView (ç”¨æˆ·è®¾ç½®)
5. **é›†æˆ**: ModelContainer æ›´æ–°ï¼Œæ‰€æœ‰æµ‹è¯•é€šè¿‡

**å¾…åç»­ Sprint å®Œæˆçš„åŠŸèƒ½**:
- æ•°æ®å¯¼å‡º (CSV/PDF)
- æœ€ä½³æœç”¨æ—¶é—´å»ºè®®
- æ¯æ—¥æé†’é€šçŸ¥

---

## ğŸ“ é™„å½•

### A. æ•°æ®æ¨¡å‹å…³ç³»å›¾

```
UserProfile
    |
    v
Supplement -----> Nutrient (embedded)
    |
    v
IntakeRecord -----> Nutrient (snapshot)
    |
    v
DailyIntakeSummary (computed)
    |
    v
WeeklyTrend (computed)
```

### B. UI å¯¼èˆªæµç¨‹å›¾

```
TabView
â”œâ”€â”€ DashboardView (é¦–é¡µ)
â”‚   â”œâ”€â”€ TodaySummaryCard
â”‚   â”œâ”€â”€ QuickRecordButton -> IntakeRecordView
â”‚   â””â”€â”€ NutrientProgress -> NutrientDetailView
â”‚
â”œâ”€â”€ IntakeRecordView (è®°å½•)
â”‚   â”œâ”€â”€ SupplementSelector
â”‚   â”œâ”€â”€ ServingPicker
â”‚   â””â”€â”€ TodayRecordsList
â”‚
â”œâ”€â”€ SupplementListView (è¡¥å‰‚)
â”‚   â””â”€â”€ SupplementDetailView
â”‚       â””â”€â”€ SupplementFormView
â”‚
â”œâ”€â”€ HistoryView (å†å²)
â”‚   â”œâ”€â”€ CalendarView
â”‚   â””â”€â”€ DayDetailView
â”‚
â””â”€â”€ ProfileView (æˆ‘çš„)
    â””â”€â”€ SettingsView
```

### C. Swift Charts ä½¿ç”¨ç¤ºä¾‹

```swift
import Charts

struct NutrientTrendChart: View {
    let dataPoints: [DataPoint]
    let recommended: Double

    var body: some View {
        Chart {
            ForEach(dataPoints, id: \.date) { point in
                LineMark(
                    x: .value("Date", point.date),
                    y: .value("Amount", point.value)
                )
                .foregroundStyle(.blue)
            }

            RuleMark(y: .value("Recommended", recommended))
                .foregroundStyle(.green.opacity(0.5))
                .lineStyle(StrokeStyle(dash: [5, 5]))
        }
        .chartYAxis {
            AxisMarks(position: .leading)
        }
    }
}
```
